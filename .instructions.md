# BryteLinks — AI Code Generation Instructions

> **Purpose**: This file provides every convention, pattern, file location, and integration
> rule an AI model needs to generate code that is consistent with the existing codebase.
> Follow these rules **exactly** to avoid duplication, rework, and broken imports.

---

## 1. Project Overview

**BryteLinks** is a multi-vendor telecom data-selling SaaS platform for Ghana.
Agents buy data bundles and resell them through personal storefronts.

| Layer | Tech | Entry point |
|-------|------|-------------|
| Backend | Node.js 24, Express 5, MongoDB/Mongoose 8, ES Modules | `backend/app.js` |
| Frontend | React 19, Vite 6, TypeScript 5.9, Tailwind CSS v4 | `frontend/src/main.tsx` |
| Monorepo | npm workspaces (`frontend/`, `backend/`) | Root `package.json` |

### Key libraries already installed

| Frontend | Backend |
|----------|---------|
| React Router DOM 7 | Express 5 (ES Modules) |
| TanStack React Query 5 | Mongoose 8 |
| Axios 1.13 | JWT (jsonwebtoken) |
| shadcn/ui (new-york, configured, **no components installed yet**) | bcrypt |
| Tailwind CSS v4 + tw-animate-css | express-validator |
| Recharts 3 (for charts) | Winston (logging) |
| React Hook Form 7 + Zod 4 (for forms) | ws (WebSocket) |
| class-variance-authority, clsx, tailwind-merge | node-cron (jobs) |
| lucide-react (icons) | nodemailer |

---

## 2. Monorepo Structure

```
data-site/
├─ package.json              # Root — npm workspaces, "concurrently" scripts
├─ backend/
│  ├─ app.js                 # Express app entry — mounts all routes
│  ├─ package.json           # type: "module"
│  ├─ .env / .env.example
│  └─ src/
│     ├─ config/             # db.js, redis.js
│     ├─ constants/
│     ├─ controllers/        # Class-based or object controllers
│     ├─ jobs/               # node-cron scheduled jobs
│     ├─ middlewares/        # auth.js (authenticate, authorize, authorizeBusinessUser)
│     ├─ models/             # Mongoose schemas
│     ├─ routes/             # Express routers — mount in app.js
│     ├─ scripts/            # One-off scripts (seedAdmin.js, etc.)
│     ├─ services/           # Business logic layer
│     ├─ utils/              # Helpers (logger.js, userTypeHelpers.js)
│     └─ validators/         # express-validator rule arrays
└─ frontend/
   ├─ package.json
   ├─ vite.config.ts         # @/ alias, proxy /api → localhost:5050
   ├─ tsconfig.json          # strict, paths: @/* → ./src/*
   ├─ components.json         # shadcn — new-york style, baseColor slate
   └─ src/
      ├─ main.tsx            # ReactDOM root, QueryClient, BrowserRouter
      ├─ App.tsx             # All route definitions (lazy-loaded)
      ├─ index.css           # Tailwind v4, CSS variables (light + dark)
      ├─ types/index.ts      # ALL shared TypeScript types
      ├─ lib/
      │  ├─ api.ts           # Axios instance, interceptors, typed helpers
      │  ├─ query-keys.ts    # Centralised TanStack query key factory
      │  └─ utils.ts         # cn() from clsx + tailwind-merge
      ├─ contexts/
      │  └─ AuthContext.tsx   # Auth state, login/logout, hasRole()
      ├─ services/           # API call modules (one per domain)
      │  ├─ index.ts         # Barrel export
      │  ├─ orders.service.ts
      │  ├─ wallet.service.ts
      │  └─ …               # 14 service files total
      ├─ hooks/              # TanStack Query hooks (one per domain)
      │  ├─ index.ts         # Barrel export
      │  ├─ use-orders.ts
      │  ├─ use-wallet.ts
      │  └─ …               # 12 hook files total
      ├─ components/
      │  ├─ guards/          # RoleGuard.tsx, GuestGuard.tsx
      │  ├─ layouts/         # AdminLayout.tsx, DashboardLayout.tsx, AuthLayout.tsx
      │  └─ ui/              # shadcn components (install as needed)
      └─ pages/
         ├─ admin/           # 12 admin pages  (AdminDashboardPage.tsx, etc.)
         ├─ orders/          # Agent-facing order pages
         ├─ wallet/          # Agent-facing wallet pages
         └─ …               # Other domain folders
```

---

## 3. Role System

### 3.1 User roles (enum — single source of truth)

```
"admin" | "agent" | "super_agent" | "dealer" | "super_dealer"
```

- Backend: `User.userType` enum in `backend/src/models/User.js` line 35
- Frontend: `UserRole` type in `frontend/src/types/index.ts` line 4

### 3.2 Role groups (already defined — reuse, do NOT duplicate)

| Group | Backend (`userTypeHelpers.js`) | Frontend (`types/index.ts`) |
|-------|-------------------------------|----------------------------|
| Business users | `BUSINESS_USER_TYPES` | `BUSINESS_ROLES` |
| Wallet-enabled | `WALLET_ENABLED_USER_TYPES` | — |
| Tenant users | `TENANT_USER_TYPES` | — |
| Admin | `ADMIN_USER_TYPES` | `ADMIN_ROLES` |

**Backend helper functions** (import from `../utils/userTypeHelpers.js`):
- `isBusinessUser(userType)` — agent, super_agent, dealer, super_dealer
- `isAdminUser(userType)` — admin
- `canHaveWallet(userType)`
- `isTenantUser(userType)`
- `getTenantId(user)` — resolves tenantId for any user

⚠️ **NEVER hard-code role lists. ALWAYS use these helpers/constants.**

### 3.3 Route access patterns

| Access level | Backend middleware | Frontend guard |
|----------|-------------------|---------------|
| Any authenticated user | `authenticate` | `<RoleGuard />` (no `allowedRoles`) |
| Admin only | `authenticate, authorize("admin")` | `<RoleGuard allowedRoles={["admin"]} />` |
| Business users only | `authenticate, authorizeBusinessUser` | `<RoleGuard allowedRoles={[...BUSINESS_ROLES]} />` |
| Specific roles | `authenticate, authorize("admin", "agent")` | `<RoleGuard allowedRoles={["admin", "agent"]} />` |
| Public / guest | No middleware | `<GuestGuard />` |

---

## 4. Backend Conventions

### 4.1 File naming
- Models: `PascalCase.js` (e.g., `User.js`, `WalletTransaction.js`)
- Everything else: `camelCase.js` (e.g., `orderController.js`, `authRoutes.js`)
- One domain per file — don't mix concerns

### 4.2 Module system
- **ES Modules** (`"type": "module"` in package.json)
- Use `import/export` — **never** `require()`
- File extensions required in imports: `import User from "../models/User.js"`

### 4.3 Controller pattern
Controllers are **class instances** exported as a default object with bound methods:
```js
// src/controllers/exampleController.js
class ExampleController {
  async getAll(req, res) {
    try {
      // ...
      res.status(200).json({ success: true, data: result });
    } catch (error) {
      logger.error(`Error: ${error.message}`);
      res.status(500).json({ success: false, message: "..." });
    }
  }
}

const exampleController = new ExampleController();
export default {
  getAll: exampleController.getAll.bind(exampleController),
};
```

### 4.4 Route pattern
```js
// src/routes/exampleRoutes.js
import express from "express";
import controller from "../controllers/exampleController.js";
import { authenticate, authorize } from "../middlewares/auth.js";
import validate from "../middlewares/validate.js";
import { exampleValidation } from "../validators/exampleValidator.js";

const router = express.Router();

// SPECIFIC routes BEFORE parameterised routes
router.get("/analytics", authenticate, authorize("admin"), controller.getAnalytics);
router.get("/", authenticate, controller.getAll);
router.get("/:id", authenticate, controller.getById);
router.post("/", authenticate, validate(exampleValidation.create), controller.create);
router.patch("/:id", authenticate, controller.update);
router.delete("/:id", authenticate, authorize("admin"), controller.delete);

export default router;
```
Mount in `app.js`: `app.use("/api/example", exampleRoutes);`

### 4.5 Validator pattern
```js
// src/validators/exampleValidator.js
import { body, param, query } from "express-validator";

export const exampleValidation = {
  create: [
    body("name").trim().notEmpty().withMessage("Name is required"),
    body("email").isEmail().withMessage("Valid email required"),
  ],
};
```

### 4.6 Response format (strictly follow)
```js
// Success
res.status(200).json({ success: true, data: result, message: "..." });

// Success with pagination
res.status(200).json({ success: true, data: items, total, page, limit });

// Error
res.status(400).json({ success: false, message: "Validation error" });
res.status(404).json({ success: false, message: "Not found" });
res.status(500).json({ success: false, message: "Internal server error" });
```

### 4.7 Existing models (do NOT recreate)
| Model | File |
|-------|------|
| User | `models/User.js` |
| Order | `models/Order.js` |
| Package | `models/Package.js` |
| Bundle | `models/Bundle.js` |
| Provider | `models/Provider.js` |
| WalletTransaction | `models/WalletTransaction.js` |
| Notification | `models/Notification.js` |
| Announcement | `models/Announcement.js` |
| CommissionRecord | `models/CommissionRecord.js` |
| CommissionMonthlySummary | `models/CommissionMonthlySummary.js` |
| AgentStorefront | `models/AgentStorefront.js` |
| StorefrontPricing | `models/StorefrontPricing.js` |
| Settings | `models/Settings.js` |

### 4.8 Logging
```js
import logger from "../utils/logger.js";
logger.info("...");
logger.warn("...");
logger.error("...");
```
**Never** use `console.log` in backend code — always use the Winston logger.

### 4.9 Environment variables
Defined in `backend/.env`. Reference via `process.env.VAR_NAME`.
See `backend/.env.example` for all available variables.

---

## 5. Frontend Conventions

### 5.1 Path alias
All imports use `@/` prefix which maps to `frontend/src/`:
```ts
import { useAuth } from "@/contexts/AuthContext";
import { ordersService } from "@/services/orders.service";
import type { Order, OrderFilters } from "@/types";
```

### 5.2 TypeScript types — SINGLE SOURCE OF TRUTH
**ALL** shared types live in `frontend/src/types/index.ts`.
- **NEVER** define inline types for API responses or domain models.
- **ALWAYS** check `types/index.ts` before creating any new type.
- If a type is missing, add it to `types/index.ts`.

Existing types (non-exhaustive): `User`, `UserRole`, `Order`, `OrderItem`, `OrderFilters`,
`Provider`, `Package`, `Bundle`, `WalletInfo`, `WalletTransaction`,
`Notification`, `Announcement`, `CommissionRecord`, `Storefront`,
`ApiResponse<T>`, `PaginatedResponse<T>`, `PaginationParams`, `TimeframeParam`

### 5.3 API service layer — `frontend/src/services/`

Each domain has a service file exporting a **const object** of functions:

```ts
// src/services/example.service.ts
import { apiGet, apiPost, apiPut, apiPatch, apiDelete, buildParams } from "@/lib/api";
import type { ApiResponse, PaginatedResponse, Example, ExampleFilters } from "@/types";

const BASE = "/example";

export const exampleService = {
  list: (filters?: ExampleFilters) =>
    apiGet<PaginatedResponse<Example>>(BASE, {
      params: filters ? buildParams(filters as Record<string, string | number | boolean | undefined>) : undefined,
    }),

  getById: (id: string) =>
    apiGet<ApiResponse<Example>>(`${BASE}/${id}`),

  create: (payload: CreateExamplePayload) =>
    apiPost<ApiResponse<Example>>(BASE, payload),

  update: (id: string, payload: Partial<CreateExamplePayload>) =>
    apiPatch<ApiResponse<Example>>(`${BASE}/${id}`, payload),

  delete: (id: string) =>
    apiDelete<ApiResponse>(`${BASE}/${id}`),
};
```

**Rules:**
- Import `apiGet`, `apiPost`, `apiPut`, `apiPatch`, `apiDelete`, `buildParams` from `@/lib/api`
- Return type is `ApiResponse<T>` or `PaginatedResponse<T>` from `@/types`
- Use `buildParams()` for query params to filter out undefined values
- Export the service object for use in hooks
- Add the export to `services/index.ts` barrel

### 5.4 Existing API helper functions (`lib/api.ts`)

| Function | Purpose |
|----------|---------|
| `apiGet<T>(url, config?)` | GET request, returns typed `data` |
| `apiPost<T>(url, body?, config?)` | POST request |
| `apiPut<T>(url, body?, config?)` | PUT request |
| `apiPatch<T>(url, body?, config?)` | PATCH request |
| `apiDelete<T>(url, config?)` | DELETE request |
| `buildParams(params)` | Strips undefined values from params object |
| `tokenStorage` | `getAccessToken()`, `getRefreshToken()`, `setTokens()`, `clearTokens()` |
| `ApiError` | Custom error class with `status`, `code`, `data` |

⚠️ **NEVER create a new Axios instance. ALWAYS use these helpers** — they handle auth tokens and refresh automatically.

### 5.5 TanStack Query hooks — `frontend/src/hooks/`

Each domain has a hook file with queries and mutations:

```ts
// src/hooks/use-example.ts
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { queryKeys } from "@/lib/query-keys";
import { exampleService } from "@/services/example.service";
import type { ExampleFilters, CreateExamplePayload } from "@/types";

// ── Queries ─────────────────────────────────

export function useExamples(filters?: ExampleFilters) {
  return useQuery({
    queryKey: queryKeys.example.list(filters),
    queryFn: () => exampleService.list(filters),
  });
}

export function useExample(id: string) {
  return useQuery({
    queryKey: queryKeys.example.detail(id),
    queryFn: () => exampleService.getById(id),
    enabled: !!id,
  });
}

// ── Mutations ───────────────────────────────

export function useCreateExample() {
  const qc = useQueryClient();
  return useMutation({
    mutationFn: (payload: CreateExamplePayload) => exampleService.create(payload),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: queryKeys.example.root });
    },
  });
}
```

**Rules:**
- Queries use `queryKeys` from `@/lib/query-keys.ts` — **NEVER** inline query key arrays
- Mutations invalidate related query keys on success via `queryKey: queryKeys.domain.root`
- Cross-domain invalidation is expected (e.g., creating an order also invalidates wallet)
- Export all hooks and add to `hooks/index.ts` barrel
- Use `enabled: !!id` for detail queries that depend on a parameter

### 5.6 Query key factory — `frontend/src/lib/query-keys.ts`

Centralised, type-safe keys. When adding a new domain:

```ts
// Add to the queryKeys object:
example: {
  root: ["example"] as const,
  list: (filters?: ExampleFilters) =>
    [...queryKeys.example.root, "list", filters ?? {}] as const,
  detail: (id: string) =>
    [...queryKeys.example.root, "detail", id] as const,
},
```

⚠️ **NEVER create query keys outside this file.**

### 5.7 Auth context — `frontend/src/contexts/AuthContext.tsx`

Available via `useAuth()` hook:
```ts
const { user, isLoading, isAuthenticated, login, logout, hasRole } = useAuth();
```

- `user: User | null` — current user object
- `hasRole(...roles: UserRole[])` — check if user has any of the given roles
- `login(email, password)` — returns `User` for role-based redirect
- `logout()` — clears tokens, wipes query cache

⚠️ **NEVER check auth status by reading localStorage directly. ALWAYS use `useAuth()`.**

---

## 6. Frontend — UI & Styling Conventions

### 6.1 Design system
- **Tailwind CSS v4** with CSS custom properties (see `index.css`)
- **shadcn/ui** (new-york style) — configured but **no components installed yet**
  - Install on demand: `npx shadcn@latest add button input card table dialog ...`
  - Components go to `frontend/src/components/ui/`
  - Use the `cn()` utility from `@/lib/utils` for class merging
- **lucide-react** for icons
- **Recharts** for charts/data visualisation

### 6.2 Color tokens (use these, not raw colors)

| Token | Usage |
|-------|-------|
| `bg-background` / `text-foreground` | Page background / main text |
| `bg-card` / `text-card-foreground` | Card surfaces |
| `bg-primary` / `text-primary-foreground` | Primary buttons, active nav |
| `bg-secondary` / `text-secondary-foreground` | Secondary actions |
| `bg-muted` / `text-muted-foreground` | Subdued text, labels |
| `bg-accent` / `text-accent-foreground` | Hover states |
| `bg-destructive` / `text-destructive` | Error states, delete buttons |
| `border-border` | All borders |
| `border-input` | Form input borders |
| `ring-ring` | Focus rings |
| `bg-primary/10 text-primary` | Active sidebar item |

### 6.3 Common UI patterns (copy these exactly)

**Page heading:**
```tsx
<h1 className="text-2xl font-bold text-foreground">Page Title</h1>
```

**Stat card:**
```tsx
<div className="rounded-lg border border-border bg-card p-5">
  <p className="text-sm font-medium text-muted-foreground">Label</p>
  <p className="mt-1 text-2xl font-bold text-foreground">Value</p>
</div>
```

**Card/section container:**
```tsx
<div className="rounded-lg border border-border bg-card p-6">
  {/* content */}
</div>
```

**Stat grid:**
```tsx
<div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
  {/* StatCard components */}
</div>
```

**Page layout spacing:**
```tsx
<div className="space-y-6">
  {/* page heading, stat grid, content sections */}
</div>
```

**Primary button:**
```tsx
<button className="inline-flex h-10 items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90 disabled:pointer-events-none disabled:opacity-50">
  Action
</button>
```

**Form input:**
```tsx
<input className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring" />
```

**Error alert:**
```tsx
<div className="rounded-md border border-destructive/50 bg-destructive/10 p-3 text-sm text-destructive">
  {error}
</div>
```

**Loading state:**
```tsx
<p className="text-muted-foreground">Loading...</p>
// OR for full page:
<div className="flex h-full min-h-[50vh] items-center justify-center">
  <div className="h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent" />
</div>
```

**Empty state:**
```tsx
<div className="rounded-lg border border-border bg-card p-8 text-center text-muted-foreground">
  <p>No data available.</p>
</div>
```

### 6.4 When to use shadcn components vs raw Tailwind

- **Tables**: Install and use `npx shadcn@latest add table` for data tables
- **Dialogs/Modals**: Use `npx shadcn@latest add dialog`
- **Dropdowns**: Use `npx shadcn@latest add dropdown-menu`
- **Forms**: Use `npx shadcn@latest add form input label select textarea checkbox`
- **Toasts**: Use `npx shadcn@latest add sonner` (preferred) or `toast`
- **Simple cards, grids, buttons**: Use raw Tailwind (patterns above)

Install components with: `npx shadcn@latest add <component-name>`

### 6.5 Form handling
- **react-hook-form** + **zod** for validated forms
- Define Zod schema → infer TypeScript type → use with `useForm<T>`
```tsx
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";

const schema = z.object({
  name: z.string().min(2, "Name is required"),
  email: z.string().email("Valid email required"),
});

type FormData = z.infer<typeof schema>;

function MyForm() {
  const { register, handleSubmit, formState: { errors } } = useForm<FormData>({
    resolver: zodResolver(schema),
  });

  const onSubmit = (data: FormData) => { /* call mutation */ };

  return <form onSubmit={handleSubmit(onSubmit)}>...</form>;
}
```

### 6.6 Charts
Use **Recharts** (already installed):
```tsx
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from "recharts";
```
Use CSS variable colors via `var(--chart-1)` through `var(--chart-5)`.

---

## 7. Routing & Page Architecture

### 7.1 Route structure (defined in `App.tsx`)

| Path prefix | Layout | Guard | Audience |
|-------------|--------|-------|----------|
| `/login`, `/forgot-password`, `/reset-password` | `AuthLayout` | `GuestGuard` | Unauthenticated |
| `/admin/*` | `AdminLayout` | `RoleGuard allowedRoles={["admin"]}` | Admin only |
| `/*` (dashboard, orders, etc.) | `AgentLayout` (DashboardLayout) | `RoleGuard allowedRoles={[...BUSINESS_ROLES]}` | Business users |

### 7.2 Adding a new page

1. Create the page component in the appropriate directory:
   - Admin page: `pages/admin/AdminXxxPage.tsx`
   - Agent page: `pages/xxx/XxxPage.tsx`
2. Add a lazy import in `App.tsx`
3. Add the `<Route>` under the appropriate layout/guard group
4. Add the nav link in the appropriate layout:
   - Admin: Add to `NAV_GROUPS` in `AdminLayout.tsx`
   - Agent: Add to `NAV_ITEMS` in `DashboardLayout.tsx`

### 7.3 Page component pattern

```tsx
// pages/admin/AdminExamplePage.tsx
import { useExamples, useCreateExample } from "@/hooks/use-example";
// Optional: import { useAuth } from "@/contexts/AuthContext";

export default function AdminExamplePage() {
  const { data, isLoading } = useExamples();

  if (isLoading) {
    return <p className="text-muted-foreground">Loading...</p>;
  }

  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold text-foreground">Example</h1>

      <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
        {/* Stat cards */}
      </div>

      <div className="rounded-lg border border-border bg-card p-6">
        {/* Table, list, or content */}
      </div>
    </div>
  );
}
```

All pages use **default export** and are **lazy-loaded** in `App.tsx`.

---

## 8. Full-stack Feature Implementation Checklist

When implementing a new feature end-to-end, follow this exact order:

### Backend
- [ ] **Model** — Create/update Mongoose schema in `models/` (if new entity)
- [ ] **Validator** — Create validation rules in `validators/` (if new inputs)
- [ ] **Service** — Business logic in `services/` (optional, for complex logic)
- [ ] **Controller** — Request handling in `controllers/` (follow class + bind pattern)
- [ ] **Routes** — Wire routes in `routes/` with proper middleware chain
- [ ] **Mount** — Import and mount router in `app.js`: `app.use("/api/xxx", xxxRoutes)`

### Frontend
- [ ] **Types** — Add new types/interfaces to `types/index.ts`
- [ ] **Service** — Create `services/xxx.service.ts` using `apiGet`/`apiPost` helpers
- [ ] **Service barrel** — Add export to `services/index.ts`
- [ ] **Query keys** — Add domain keys to `lib/query-keys.ts`
- [ ] **Hooks** — Create `hooks/use-xxx.ts` with queries + mutations
- [ ] **Hook barrel** — Add export to `hooks/index.ts`
- [ ] **UI components** — Install any needed shadcn components
- [ ] **Page** — Create page component in `pages/`
- [ ] **Route** — Add lazy import + `<Route>` in `App.tsx`
- [ ] **Navigation** — Add nav link in appropriate layout

---

## 9. Critical Rules — DO NOT VIOLATE

### 9.1 Reuse existing infrastructure

| Need | Use this | DON'T do this |
|------|----------|---------------|
| HTTP request | `apiGet/apiPost/etc` from `@/lib/api` | Create new Axios instance |
| Auth state | `useAuth()` from `@/contexts/AuthContext` | Read localStorage |
| Role check | `hasRole()` from context or ROLE constants | Hard-code role strings inline |
| Query cache | `queryKeys` from `@/lib/query-keys` | Inline string arrays |
| Class merging | `cn()` from `@/lib/utils` | Template literal concatenation |
| Types | Import from `@/types` | Define types in component files |
| Business user check (backend) | `isBusinessUser()` from `userTypeHelpers.js` | Inline array `.includes()` |
| Admin check (backend) | `isAdminUser()` from `userTypeHelpers.js` | `userType === "admin"` |
| Logging (backend) | `logger` from `utils/logger.js` | `console.log` |

### 9.2 Naming conventions

| What | Convention | Example |
|------|-----------|---------|
| Frontend service file | `kebab-case.service.ts` | `orders.service.ts` |
| Frontend hook file | `use-kebab-case.ts` | `use-orders.ts` |
| Frontend page file | `PascalCase.tsx` | `AdminOrdersPage.tsx` |
| Frontend component | `PascalCase.tsx` | `StatCard.tsx` |
| Backend model | `PascalCase.js` | `WalletTransaction.js` |
| Backend controller | `camelCase.js` | `walletController.js` |
| Backend route | `camelCase.js` | `walletRoutes.js` |
| Backend service | `camelCase.js` | `walletService.js` |
| Backend validator | `camelCase.js` | `walletValidator.js` |
| API routes prefix | `/api/<plural-noun>` | `/api/orders`, `/api/users` |
| Query hook | `use<PascalDomain>()` | `useOrders()`, `useWalletInfo()` |
| Mutation hook | `use<Action><Domain>()` | `useCreateOrder()`, `useUpdateUser()` |

### 9.3 Import order (frontend)

```ts
// 1. React / third-party
import { useState, useEffect } from "react";
import { useNavigate } from "react-router-dom";
import { useQueryClient } from "@tanstack/react-query";

// 2. Internal modules (@/ alias)
import { useAuth } from "@/contexts/AuthContext";
import { queryKeys } from "@/lib/query-keys";
import { ordersService } from "@/services/orders.service";
import { useOrders } from "@/hooks/use-orders";

// 3. Types (with `type` keyword)
import type { Order, OrderFilters } from "@/types";
```

### 9.4 TypeScript strictness
- `strict: true` is enabled
- `noUnusedLocals: true` — don't leave dead code
- `noUnusedParameters: true` — prefix unused params with `_`
- `verbatimModuleSyntax: true` — use `import type` for type-only imports

### 9.5 Backend module system
- ALL files use ES Modules (`import`/`export`)
- File extensions are REQUIRED in import paths: `import X from "./file.js"`
- `"type": "module"` is set in `backend/package.json`

---

## 10. Existing API Endpoints Reference

The backend exposes these route groups (all mounted under `/api`):

| Route prefix | File | Description |
|------------|------|-------------|
| `/api/auth` | `authRoutes.js` | Login, register, verify, password reset |
| `/api/orders` | `orderRoutes.js` | CRUD, processing, analytics |
| `/api/packages` | `packageRoutes.js` | Data package management |
| `/api/bundles` | `bundleRoutes.js` | Bundle management, pricing |
| `/api/providers` | `providerRoutes.js` | Telecom provider CRUD |
| `/api/users` | `userRoutes.js` | User management |
| `/api/wallet` | `walletRoutes.js` | Wallet ops, top-ups, transactions |
| `/api/settings` | `settingsRoutes.js` | Platform configuration |
| `/api/notifications` | `notificationRoutes.js` | User notifications |
| `/api/analytics` | `analyticsRoutes.js` | Platform analytics |
| `/api/commissions` | `commissionRoutes.js` | Commission tracking |
| `/api/announcements` | `announcementRoutes.js` | Platform announcements |
| `/api/storefronts` | `storefrontRoutes.js` | Agent storefront management |
| `/api/push` | `pushNotificationRoutes.js` | Web push subscriptions |
| `/api/public` | `publicRoutes.js` | Public-facing endpoints |

**Before creating a new endpoint**, check the existing route file — it likely already exists.

---

## 11. Proxy & CORS Configuration

- Vite dev server proxies `/api` → `http://localhost:5050` (see `vite.config.ts`)
- Frontend services use relative URLs (`/orders`, not `http://localhost:5050/api/orders`)
- Backend CORS is configured for `FRONTEND_URL` from `.env`
- In production, set `VITE_API_URL` to the backend URL

---

## 12. Environment Setup

### Development
```bash
# Root
npm install            # Installs all workspaces
npm run dev            # Starts both backend (nodemon) and frontend (vite)

# Individual
npm run dev:backend    # Backend only (nodemon on port 5050)
npm run dev:frontend   # Frontend only (vite on port 5173)
```

### Required environment variables (backend/.env)
See `backend/.env.example` for all variables. Critical ones:
- `DBURI` — MongoDB connection string
- `JWTSECRET` — JWT access token secret
- `REFRESH_TOKEN_SECRET` — Refresh token signing secret
- `PORT` — Backend port (default 5050)
- `FRONTEND_URL` — Frontend URL for CORS

---

## 15. Backend Editing Permissions

**When fixing authentication, security, or data consistency issues, the AI agent is permitted to edit backend files** to ensure proper synchronization between frontend and backend systems. This includes:

- Modifying auth controllers, routes, and middleware
- Updating token handling and validation logic
- Fixing response formats and API contracts
- Ensuring database operations are secure and consistent
- Updating validation rules and error handling

**Always maintain backward compatibility** and test changes thoroughly before proceeding.

---

---

## 14. Common Mistakes to Avoid

1. **Creating a new Axios instance** — Use `apiGet`/`apiPost` from `@/lib/api`
2. **Inline query keys** — Always use `queryKeys` from `@/lib/query-keys`
3. **Defining types in components** — Put them in `@/types/index.ts`
4. **Using `console.log` in backend** — Use `logger` from Winston
5. **Hard-coding role strings** — Use role helpers/constants
6. **Forgetting to add to barrel exports** — Update `services/index.ts` and `hooks/index.ts`
7. **Creating duplicate service/hook** — Check existing files first
8. **Not lazy-loading pages** — All pages in `App.tsx` must use `lazy()`
9. **Missing `enabled` on detail queries** — Set `enabled: !!id` when ID might be empty
10. **Forgetting middleware chain** — Routes need `authenticate` + `authorize()` as appropriate
11. **Not using `buildParams()`** — Prevents undefined values in query strings
12. **Importing without `type` keyword** — Use `import type { ... }` for type-only imports
13. **Using `require()`** — Backend uses ES Modules exclusively
14. **Missing file extensions in backend imports** — Always include `.js`
15. **Creating raw HTML elements when shadcn components exist** — Install and use shadcn
